# 💘 大型网站核心架构要素

---

**软件架构 software architecture**：<u>有关软件整体结构与组件的抽象描述，用于指导大型软件系统各个方面的设计。</u>软件架构是一个系统的草图。软件体系结构是构建计算机软件实践的基础。

一般来说，除了当前的系统功能需求外，软件架构还需要关注性能、可用性、伸缩性、扩展性和安全性这 5 个架构要素。架构设计过程中需要平衡这 5 个要素之间的关系以实现需求和架构目标，也可以通过考察这些架构要素来衡量一个软件架构设计的优劣。

## 1. 性能

### ① 性能指标

#### 响应时间

指某个请求从发出到接收到响应消耗的时间。

在对响应时间进行测试时，通常采用重复请求的方式，然后计算平均响应时间。

#### 吞吐量

指系统在单位时间内可以处理的请求数量，通常使用每秒的请求数来衡量。

#### 并发用户数

指系统能同时处理的并发用户请求数量。

在没有并发存在的系统中，请求被顺序执行，此时响应时间为吞吐量的倒数。例如系统支持的吞吐量为 100 req/s，那么平均响应时间应该为 0.01s。

目前的大型系统都支持多线程来处理并发请求，多线程能够提高吞吐量以及缩短响应时间，主要有两个原因：

- 多 CPU
- IO 等待时间

使用 IO 多路复用等方式，系统在等待一个 IO 操作完成的这段时间内不需要被阻塞，可以去处理其它请求。通过将这个等待时间利用起来，使得 CPU 利用率大大提高。

并发用户数不是越高越好，因为如果并发用户数太高，系统来不及处理这么多的请求，会使得过多的请求需要等待，那么响应时间就会大大提高。

### ② 性能优化

#### 集群

将多台服务器组成集群，使用负载均衡将请求转发到集群中，避免单一服务器的负载压力过大导致性能降低。

#### 缓存

缓存能够提高性能的原因如下：

- 缓存数据通常位于内存等介质中，这种介质对于读操作特别快；
- 缓存数据可以位于靠近用户的地理位置上；
- 可以将计算结果进行缓存，从而避免重复计算。

#### 异步

某些流程可以将操作转换为消息，将消息发送到消息队列之后立即返回，之后这个操作会被异步处理。

## 2. 可用性

<img src="https://gitee.com/veal98/images/raw/master/img/20201122152240.png" style="zoom: 40%;" />

💧 保证网站高可用的手段主要有：

- 冗余
- 监控
- 服务降级

### ① 冗余

保证高可用的主要手段是使用冗余，**当某个服务器故障时就请求其它服务器**。

应用服务器的冗余比较容易实现，只要保证应用服务器不具有状态，那么某个应用服务器故障时，负载均衡器将该应用服务器原先的用户请求转发到另一个应用服务器上，不会对用户有任何影响。

**存储服务器的冗余需要使用主从复制来实现，当主服务器故障时，需要提升从服务器为主服务器，这个过程称为切换。**

### ② 监控

对 CPU、内存、磁盘、网络等系统负载信息进行监控，<u>当某个信息达到一定阈值时通知运维人员，从而在系统发生故障之前及时发现问题</u>。

### ③ 服务降级

服务降级是系统为了应对大量的请求，<u>主动关闭部分功能，从而保证核心功能可用</u>。

## 3. 伸缩性

所谓伸缩性就是指**不断向集群中添加服务器，来缓解不断上升的用户并发访问压力和不断增长的数据存储需求**。

### ① 衡量伸缩性的标准

<img src="https://gitee.com/veal98/images/raw/master/img/20201122152736.png" style="zoom:40%;" />

### ② 实现伸缩性

<img src="https://gitee.com/veal98/images/raw/master/img/20201122152908.png" style="zoom:40%;" />

## 4. 扩展性

所谓扩展性指的是**添加新功能时对现有系统的其它应用无影响，这就要求不同应用具备低耦合的特点**。

实现可扩展主要有两种方式：

- 使用**消息队列**进行解耦，应用之间通过消息传递进行通信；
- 使用**分布式服务**将业务和可复用的服务分离开来，业务使用分布式服务框架调用可复用的服务。新增的产品可以通过调用可复用的服务来实现业务逻辑，对其它产品没有影响。

## 5. 安全性

所谓安全性就是**保护网站不受恶意访问和攻击，保护网站的重要数据不被窃取**。

## 📚 References

- 《大型网站技术架构：核心原理与案例分析》
- [CS-Notes](http://cyc2018.gitee.io/cs-notes/#/README)